//INITIALISATION VARIABLES
DVAR $nrad, $Var1, $resp, $XOffset, $YOffset, $ZOffset, $Feed, $SpindleSpeed, $ZSafe, $ToolLength, $ToolDiameter, $WorkThickness, $VacChuckOffset


//PROGRAM VARIABLES
DVAR $HoleDepth, $HoleDiameter, $DepthLow, $XPos, $YPos, $XStart[130], $YStart[130], $ZStart, $ZClear, $XCount, $YCount, $HoleCount, $Depth, $Feedrate, $OrbitCount, $OrbitalFeedrate, $OrbitRadius, $NumOrbits, $FeedPerOrbit, $RadiusExtra, $AngleOffset
DVAR $NumHoles, $Percent


//CHECK THESE VARIABLES EVERY JOB!
$ToolLength = FILEREADINI "C:\Users\Public\Documents\Aerotech\A3200\User Files\Southampton programs\LoxhamUserParameters.ini", "Tool", "ZToolTipPosition", -20 //tool tip position from renishaw probe
$ToolDiameter = FILEREADINI "C:\Users\Public\Documents\Aerotech\A3200\User Files\Southampton programs\LoxhamUserParameters.ini", "Tool", "ToolDiameterMeasure", 1.5 //tool diameter from renishaw probe
$WorkThickness = FILEREADINI "C:\Users\Public\Documents\Aerotech\A3200\User Files\Southampton programs\LoxhamUserParameters.ini", "Workpiece", "Thickness", 5 //Height to top surface off workpiece from top of vac chuck face
$VacChuckOffset = FILEREADINI "C:\Users\Public\Documents\Aerotech\A3200\User Files\Southampton programs\LoxhamUserParameters.ini", "Chuck", "CurrentChuck", 5 //Difference between renishaw laser height and vac chuck surface to compensate for Z offset variance

$resp = MSGBOX (DF_MSGBOX_YESNO + DF_ICON_QUESTION) "Is work thickness "  $WorkThickness  "mm ?"
IF( $resp == NO_BUTTON) THEN
$WorkThickness = MSGINPUT DF_MSGBOX_OKONLY "WORK THICKNESS; Enter work thickness in mm;" 
FILEWRITEINI "C:\Users\Public\Documents\Aerotech\A3200\User Files\Southampton programs\LoxhamUserParameters.ini", "Workpiece", "Thickness", $WorkThickness 
END IF

$ZOffset = ( $ToolLength +  $WorkThickness + $VacChuckOffset)  //position of Z zero point for work offset in relation to machine zero
$SpindleSpeed = 125000
$ZSafe = 5 //Z position to move clear in relation to machine zero
$Feed = 5 //speed for initialisation movements

//Modal Parameter initialisation
G53 // clears all fixture offsets
G90 //Absolute movements programming
G82 //position offset clear
G71 //Metric units
G27 //X-Y plane selection
G17 //X-Y plane selection
G40 //Deactivate cutter radius compensation
G109 //Allow deceleration to zero
//G108 //smooth moves

M23 S[2]($SpindleSpeed) //start tool spindle at set speed

G01 Z($ZSafe) F($Feed) //move to safe Z position
G01 A90 F20 //rotate A axis to machining position
G01 B0 C0 F5 //set other Axis to zero

//Set position of fixture offsets and turn them on
G54 Z($ZOffset)

M07 //coolant on

M11 //Z air high

F0.5

//******MAIN PROGRAM****
G90 G0 X2.2833 Y4.66478
Z2.
G0 Z0.5
G1 Z0.1 F0.1
Z-1.12
X2.27989 Y4.66492 Z-1.14588
X2.26991 Y4.66535 Z-1.17
X2.25404 Y4.66603 Z-1.19071
X2.23334 Y4.66691 Z-1.2066
X2.20925 Y4.66793 Z-1.21659
X2.18339 Y4.66903 Z-1.22
X2.08348 Y4.67329
G17 G3 X1.97932 Y4.57763 R0.1
G1 X1.76387 Y-0.48328
X6.32524 Y-0.67746
G3 X6.39713 Y-0.65121 R0.1
X6.4294 Y-0.58181 R0.1
G1 X6.43366 Y-0.4819
X6.43476 Y-0.45604 Z-1.21659
X6.43578 Y-0.43194 Z-1.2066
X6.43666 Y-0.41125 Z-1.19071
X6.43734 Y-0.39537 Z-1.17
X6.43776 Y-0.38539 Z-1.14588
X6.43791 Y-0.38199 Z-1.12
G0 Z1.
X2.27331 Y4.6652
Z0.5
G1 Z0.1 F0.1
Z-1.12
X2.2699 Y4.66535 Z-1.14588
X2.25992 Y4.66577 Z-1.17
X2.24404 Y4.66645 Z-1.19071
X2.22335 Y4.66733 Z-1.2066
X2.19926 Y4.66836 Z-1.21659
X2.1734 Y4.66946 Z-1.22
X2.07349 Y4.67371
G3 X1.96933 Y4.57805 R0.1
G1 X1.75345 Y-0.49285
X6.32481 Y-0.68745
G3 X6.39671 Y-0.6612 R0.1
X6.42898 Y-0.5918 R0.1
G1 X6.43323 Y-0.49189
X6.43433 Y-0.46603 Z-1.21659
X6.43536 Y-0.44193 Z-1.2066
X6.43624 Y-0.42124 Z-1.19071
X6.43691 Y-0.40536 Z-1.17
X6.43734 Y-0.39538 Z-1.14588
X6.43748 Y-0.39198 Z-1.12
G0 Z1.
X2.26332 Y4.66563
Z0.5
G1 Z0.1 F0.1
Z-1.12
X2.25991 Y4.66577 Z-1.14588
X2.24993 Y4.6662 Z-1.17
X2.23405 Y4.66688 Z-1.19071
X2.21336 Y4.66776 Z-1.2066
X2.18927 Y4.66878 Z-1.21659
X2.16341 Y4.66988 Z-1.22
X2.0635 Y4.67414
G3 X1.95933 Y4.57848 R0.1
G1 X1.74303 Y-0.50241
X6.32439 Y-0.69745
G3 X6.39628 Y-0.67119 R0.1
X6.42855 Y-0.60179 R0.1
G1 X6.43281 Y-0.50188
X6.43391 Y-0.47602 Z-1.21659
X6.43493 Y-0.45192 Z-1.2066
X6.43581 Y-0.43123 Z-1.19071
X6.43649 Y-0.41536 Z-1.17
X6.43691 Y-0.40537 Z-1.14588
X6.43706 Y-0.40197 Z-1.12
G0 Z1.
X2.25333 Y4.66606
Z0.5
G1 Z0.1 F0.1
Z-1.12
X2.24992 Y4.6662 Z-1.14588
X2.23994 Y4.66663 Z-1.17
X2.22406 Y4.6673 Z-1.19071
X2.20337 Y4.66818 Z-1.2066
X2.17927 Y4.66921 Z-1.21659
X2.15342 Y4.67031 Z-1.22
X2.05351 Y4.67456
G3 X1.98161 Y4.64831 R0.1
X1.94934 Y4.57891 R0.1
G1 X1.73262 Y-0.51198
X6.32396 Y-0.70744
G3 X6.39586 Y-0.68118 R0.1
X6.42813 Y-0.61178 R0.1
G1 X6.43238 Y-0.51187
X6.43348 Y-0.48601 Z-1.21659
X6.43451 Y-0.46192 Z-1.2066
X6.43539 Y-0.44122 Z-1.19071
X6.43606 Y-0.42535 Z-1.17
X6.43649 Y-0.41537 Z-1.14588
X6.43663 Y-0.41196 Z-1.12
G0 Z1.
X2.24333 Y4.66648
Z0.5
G1 Z0.1 F0.1
Z-1.12
X2.23993 Y4.66663 Z-1.14588
X2.22995 Y4.66705 Z-1.17
X2.21407 Y4.66773 Z-1.19071
X2.19338 Y4.66861 Z-1.2066
X2.16928 Y4.66963 Z-1.21659
X2.14343 Y4.67073 Z-1.22
X2.04352 Y4.67499
G3 X1.93935 Y4.57933 R0.1
G1 X1.7222 Y-0.52154
X6.32354 Y-0.71743
G3 X6.39543 Y-0.69117 R0.1
X6.4277 Y-0.62177 R0.1
G1 X6.43195 Y-0.52186
X6.43306 Y-0.496 Z-1.21659
X6.43408 Y-0.47191 Z-1.2066
X6.43496 Y-0.45121 Z-1.19071
X6.43564 Y-0.43534 Z-1.17
X6.43606 Y-0.42536 Z-1.14588
X6.43621 Y-0.42195 Z-1.12
G0 Z1.
X2.23334 Y4.66691
Z0.5
G1 Z0.1 F0.1
Z-1.12
X2.22994 Y4.66705 Z-1.14588
X2.21996 Y4.66748 Z-1.17
X2.20408 Y4.66815 Z-1.19071
X2.18339 Y4.66903 Z-1.2066
X2.15929 Y4.67006 Z-1.21659
X2.13343 Y4.67116 Z-1.22
X2.03352 Y4.67541
G3 X1.92936 Y4.57976 R0.1
G1 X1.71179 Y-0.53111
X6.32311 Y-0.72742
G3 X6.39501 Y-0.70116 R0.1
X6.42728 Y-0.63176 R0.1
G1 X6.43153 Y-0.53185
X6.43263 Y-0.50599 Z-1.21659
X6.43366 Y-0.4819 Z-1.2066
X6.43454 Y-0.46121 Z-1.19071
X6.43521 Y-0.44533 Z-1.17
X6.43564 Y-0.43535 Z-1.14588
X6.43578 Y-0.43194 Z-1.12
G0 Z1.
X2.22335 Y4.66733
Z0.5
G1 Z0.1 F0.1
Z-1.12
X2.21995 Y4.66748 Z-1.14588
X2.20997 Y4.6679 Z-1.17
X2.19409 Y4.66858 Z-1.19071
X2.1734 Y4.66946 Z-1.2066
X2.1493 Y4.67048 Z-1.21659
X2.12344 Y4.67158 Z-1.22
X2.02353 Y4.67584
G3 X1.91937 Y4.58018 R0.1
G1 X1.70137 Y-0.54068
X6.32269 Y-0.73741
G3 X6.39458 Y-0.71115 R0.1
X6.42685 Y-0.64175 R0.1
G1 X6.4311 Y-0.54184
X6.43221 Y-0.51598 Z-1.21659
X6.43323 Y-0.49189 Z-1.2066
X6.43411 Y-0.4712 Z-1.19071
X6.43479 Y-0.45532 Z-1.17
X6.43521 Y-0.44534 Z-1.14588
X6.43536 Y-0.44193 Z-1.12
G0 Z1.
X2.21336 Y4.66776
Z0.5
G1 Z0.1 F0.1
Z-1.12
X2.20996 Y4.6679 Z-1.14588
X2.19998 Y4.66833 Z-1.17
X2.1841 Y4.669 Z-1.19071
X2.16341 Y4.66988 Z-1.2066
X2.13931 Y4.67091 Z-1.21659
X2.11345 Y4.67201 Z-1.22
X2.01354 Y4.67626
G3 X1.90938 Y4.58061 R0.1
G1 X1.69095 Y-0.55024
X6.32226 Y-0.7474
G3 X6.39416 Y-0.72114 R0.1
X6.42643 Y-0.65174 R0.1
G1 X6.43068 Y-0.55183
X6.43178 Y-0.52598 Z-1.21659
X6.43281 Y-0.50188 Z-1.2066
X6.43369 Y-0.48119 Z-1.19071
X6.43436 Y-0.46531 Z-1.17
X6.43479 Y-0.45533 Z-1.14588
X6.43493 Y-0.45192 Z-1.12
G0 Z1.
X2.20337 Y4.66818
Z0.5
G1 Z0.1 F0.1
Z-1.12
X2.19997 Y4.66833 Z-1.14588
X2.18999 Y4.66875 Z-1.17
X2.17411 Y4.66943 Z-1.19071
X2.15342 Y4.67031 Z-1.2066
X2.12932 Y4.67133 Z-1.21659
X2.10346 Y4.67244 Z-1.22
X2.00355 Y4.67669
G3 X1.89939 Y4.58103 R0.1
G1 X1.68054 Y-0.55981
X6.32184 Y-0.75739
G3 X6.39373 Y-0.73114 R0.1
X6.426 Y-0.66173 R0.1
G1 X6.43025 Y-0.56182
X6.43135 Y-0.53597 Z-1.21659
X6.43238 Y-0.51187 Z-1.2066
X6.43326 Y-0.49118 Z-1.19071
X6.43394 Y-0.4753 Z-1.17
X6.43436 Y-0.46532 Z-1.14588
X6.43451 Y-0.46192 Z-1.12
G0 Z1.
X2.19338 Y4.66861
Z0.5
G1 Z0.1 F0.1
Z-1.12
X2.18998 Y4.66875 Z-1.14588
X2.17999 Y4.66918 Z-1.17
X2.16412 Y4.66985 Z-1.19071
X2.14343 Y4.67073 Z-1.2066
X2.11933 Y4.67176 Z-1.21659
X2.09347 Y4.67286 Z-1.22
X1.99356 Y4.67711
G3 X1.8894 Y4.58146 R0.1
G1 X1.67012 Y-0.56937
X6.32141 Y-0.76738
G3 X6.42558 Y-0.67173 R0.1
G1 X6.42983 Y-0.57182
X6.43093 Y-0.54596 Z-1.21659
X6.43195 Y-0.52186 Z-1.2066
X6.43284 Y-0.50117 Z-1.19071
X6.43351 Y-0.48529 Z-1.17
X6.43394 Y-0.47531 Z-1.14588
X6.43408 Y-0.47191 Z-1.12
G0 Z1.
X2.18339 Y4.66903
Z0.5
G1 Z0.1 F0.1
Z-1.12
X2.17998 Y4.66918 Z-1.14588
X2.17 Y4.6696 Z-1.17
X2.15413 Y4.67028 Z-1.19071
X2.13343 Y4.67116 Z-1.2066
X2.10934 Y4.67219 Z-1.21659
X2.08348 Y4.67329 Z-1.22
X1.98357 Y4.67754
G3 X1.87941 Y4.58188 R0.1
G1 X1.6597 Y-0.57894
X6.32099 Y-0.77737
G3 X6.42515 Y-0.68172 R0.1
G1 X6.4294 Y-0.58181
X6.4305 Y-0.55595 Z-1.21659
X6.43153 Y-0.53185 Z-1.2066
X6.43241 Y-0.51116 Z-1.19071
X6.43309 Y-0.49528 Z-1.17
X6.43351 Y-0.4853 Z-1.14588
X6.43366 Y-0.4819 Z-1.12
G0 Z1.
X2.1734 Y4.66946
Z0.5
G1 Z0.1 F0.1
Z-1.12
X2.16999 Y4.6696 Z-1.14588
X2.16001 Y4.67003 Z-1.17
X2.14414 Y4.6707 Z-1.19071
X2.12344 Y4.67158 Z-1.2066
X2.09935 Y4.67261 Z-1.21659
X2.07349 Y4.67371 Z-1.22
X1.97358 Y4.67796
G3 X1.86942 Y4.58231 R0.1
G1 X1.64929 Y-0.5885
X6.32056 Y-0.78736
G3 X6.42472 Y-0.69171 R0.1
G1 X6.42898 Y-0.5918
X6.43008 Y-0.56594 Z-1.21659
X6.4311 Y-0.54184 Z-1.2066
X6.43199 Y-0.52115 Z-1.19071
X6.43266 Y-0.50527 Z-1.17
X6.43309 Y-0.49529 Z-1.14588
X6.43323 Y-0.49189 Z-1.12
G0 Z1.
X2.16341 Y4.66988
Z0.5
G1 Z0.1 F0.1
Z-1.12
X2.16 Y4.67003 Z-1.14588
X2.15002 Y4.67045 Z-1.17
X2.13414 Y4.67113 Z-1.19071
X2.11345 Y4.67201 Z-1.2066
X2.08936 Y4.67304 Z-1.21659
X2.0635 Y4.67414 Z-1.22
X1.96359 Y4.67839
G3 X1.8917 Y4.65213 R0.1
X1.85943 Y4.58273 R0.1
G1 X1.63887 Y-0.59807
X6.32014 Y-0.79735
G3 X6.4243 Y-0.7017 R0.1
G1 X6.42855 Y-0.60179
X6.42965 Y-0.57593 Z-1.21659
X6.43068 Y-0.55183 Z-1.2066
X6.43156 Y-0.53114 Z-1.19071
X6.43224 Y-0.51526 Z-1.17
X6.43266 Y-0.50528 Z-1.14588
X6.43281 Y-0.50188 Z-1.12
G0 Z1.
X2.15342 Y4.67031
Z0.5
G1 Z0.1 F0.1
Z-1.12
X2.15001 Y4.67045 Z-1.14588
X2.14003 Y4.67088 Z-1.17
X2.12415 Y4.67155 Z-1.19071
X2.10346 Y4.67243 Z-1.2066
X2.07937 Y4.67346 Z-1.21659
X2.05351 Y4.67456 Z-1.22
X1.9536 Y4.67881
G3 X1.84943 Y4.58316 R0.1
G1 X1.62846 Y-0.60764
X6.31971 Y-0.80735
G3 X6.42387 Y-0.71169 R0.1
G1 X6.42813 Y-0.61178
X6.42923 Y-0.58592 Z-1.21659
X6.43025 Y-0.56183 Z-1.2066
X6.43113 Y-0.54113 Z-1.19071
X6.43181 Y-0.52526 Z-1.17
X6.43224 Y-0.51527 Z-1.14588
X6.43238 Y-0.51187 Z-1.12
G0 Z1.
X2.14343 Y4.67073
Z0.5
G1 Z0.1 F0.1
Z-1.12
X2.14002 Y4.67088 Z-1.14588
X2.13004 Y4.6713 Z-1.17
X2.11416 Y4.67198 Z-1.19071
X2.09347 Y4.67286 Z-1.2066
X2.06937 Y4.67389 Z-1.21659
X2.04352 Y4.67499 Z-1.22
X1.94361 Y4.67924
G3 X1.83944 Y4.58358 R0.1
G1 X1.61804 Y-0.6172
X6.31929 Y-0.81734
G3 X6.42345 Y-0.72168 R0.1
G1 X6.4277 Y-0.62177
X6.4288 Y-0.59591 Z-1.21659
X6.42983 Y-0.57182 Z-1.2066
X6.43071 Y-0.55112 Z-1.19071
X6.43138 Y-0.53525 Z-1.17
X6.43181 Y-0.52527 Z-1.14588
X6.43195 Y-0.52186 Z-1.12
G0 Z1.
X2.13343 Y4.67116
Z0.5
G1 Z0.1 F0.1
Z-1.12
X2.13003 Y4.6713 Z-1.14588
X2.12005 Y4.67173 Z-1.17
X2.10417 Y4.6724 Z-1.19071
X2.08348 Y4.67329 Z-1.2066
X2.05938 Y4.67431 Z-1.21659
X2.03352 Y4.67541 Z-1.22
X1.93362 Y4.67967
G3 X1.82945 Y4.58401 R0.1
G1 X1.60762 Y-0.62677
X6.31886 Y-0.82733
G3 X6.42302 Y-0.73167 R0.1
G1 X6.42728 Y-0.63176
X6.42838 Y-0.6059 Z-1.21659
X6.4294 Y-0.58181 Z-1.2066
X6.43028 Y-0.56112 Z-1.19071
X6.43096 Y-0.54524 Z-1.17
X6.43138 Y-0.53526 Z-1.14588
X6.43153 Y-0.53185 Z-1.12
G0 Z1.
X2.12344 Y4.67158
Z0.5
G1 Z0.1 F0.1
Z-1.12
X2.12004 Y4.67173 Z-1.14588
X2.11006 Y4.67215 Z-1.17
X2.09418 Y4.67283 Z-1.19071
X2.07349 Y4.67371 Z-1.2066
X2.04939 Y4.67474 Z-1.21659
X2.02353 Y4.67584 Z-1.22
X1.92362 Y4.68009
G3 X1.81946 Y4.58443 R0.1
G1 X1.59721 Y-0.63633
X6.31844 Y-0.83732
G3 X6.4226 Y-0.74166 R0.1
G1 X6.42685 Y-0.64175
X6.42795 Y-0.61589 Z-1.21659
X6.42898 Y-0.5918 Z-1.2066
X6.42986 Y-0.57111 Z-1.19071
X6.43053 Y-0.55523 Z-1.17
X6.43096 Y-0.54525 Z-1.14588
X6.4311 Y-0.54184 Z-1.12
G0 Z2.



MSGDISPLAY 1,"Milling finished at #TS" 
//Footer Code
G53 //Clears Fixture offset
G82 //Clears machine offset
Z($ZSafe) F($Feed)
M09 //Coolant off
M25 //spindle off
M10 // Z air low
DWELL 2.0
A-90 F20
//CamZ $WorkThickness + 2
FARCALL "MEASURE OFFSETS.PGM"

END PROGRAM
